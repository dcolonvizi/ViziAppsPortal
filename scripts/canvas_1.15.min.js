function xmlEncode(a) { return a.replace(/\&/g, "&" + "amp;").replace(/</g, "&" + "lt;").replace(/>/g, "&" + "gt;").replace(/\'/g, "&" + "apos;").replace(/\"/g, "&" + "quot;") } function insertHtml(a, b) { $("form").append(a); enableDragAndResizing(b); getCanvasHtml() } function getCanvasHtml() { var a = document.getElementById("form1"); var b = parent.window.document.getElementById("SavedCanvasHtml"); b.value = xmlEncode(a.innerHTML) } function enableDragAndResizing(a) { createDragResize("[id=" + a + "]") } function createDragResize(a) { var b = parent.window.document.getElementById("CanvasFrame"); box = new Array(4); box[0] = 0; box[1] = 0; box[2] = parseInt(b.style.width.replace("px", "")); box[3] = parseInt(b.style.height.replace("px", "")); $(a).draggable({ distance: 5, drag: function (b, c) { var d = $(a).draggable("option", "grid"); if (isGridSnapSet && (!d || d[0] != gridSize)) { var e = parseInt($(this).css("top").replace("px", "")); if (e % gridSize != 0) $(this).css("top", e - e % gridSize + "px"); var f = parseInt($(this).css("left").replace("px", "")); if (f % gridSize != 0) $(this).css("left", f - f % gridSize + "px") } else if (isGridSnapSet) { $(this).draggable("option", "grid", [gridSize, gridSize]) } else if (!isGridSnapSet) { $(".selector").draggable("option", "snap", false) } createHelper(this); createAlignment(this) }, stop: function (a, b) { if (isGridSnapSet) { var c = parseInt($(this).css("top").replace("px", "")); if (c % gridSize != 0) $(this).css("top", c - c % gridSize + "px"); var d = parseInt($(this).css("left").replace("px", "")); if (d % gridSize != 0) $(this).css("left", d - d % gridSize + "px") } removeAlignment(); $(this).draggable("option", "distance", 5); getCanvasHtml() }, containment: box, scroll: false }); $(a).resizable({ resize: function (a, b) { $("p").vAlign(); createHelper(this) }, stop: function (a, b) { getCanvasHtml() } }); $(".ui-resizable-se").removeClass("ui-icon"); $(a).css("border", "2px dotted transparent"); $(a).click(function (a) { var b = parent.window.document.getElementById("canvas"); b.focus(); if (prev_selected) prev_selected.css("border-color", "transparent"); $(this).css("border-color", "blue"); prev_selected = $(this); setSelectedHtml($(this).clone()); a.stopImmediatePropagation() }); $(a).mouseover(function () { $(this).css("cursor", "move"); $(this).find(".ui-resizable-se").addClass("ui-icon"); createHelper(this); if (!prev_selected || prev_selected && prev_selected[0].id != this.id) $(this).css("border-color", "grey") }).mouseout(function () { $(this).find(".ui-resizable-se").removeClass("ui-icon"); $(".helper_box").remove(); if (!prev_selected || prev_selected && prev_selected[0].id != this.id) $(this).css("border-color", "transparent") }); $(a).dblclick(function (a) { if (prev_selected) { parent.window.doEditProperties() } }); $("*").click(function () { if (prev_selected) { prev_selected.css("border-color", "transparent"); prev_selected = null; clearSelectedHtml(); $(".helper_box").remove() } }) } function createHelper(a) { if ($("form").find(".helper_box")) $(".helper_box").remove(); $("form").append('<div class="helper_box" style="z-index:100000;background-color:gray;white-space:nowrap;"/>'); $("form").find(".helper_box").append($(a).attr("id") + "<br/>x:" + $(a).css("left").replace("px", "") + ", y:" + $(a).css("top").replace("px", "") + ", w:" + $(a).css("width").replace("px", "") + ", h:" + $(a).css("height").replace("px", "")); $("form").find(".helper_box").css("position", "absolute"); var b = parseInt($(a).css("top").replace("px", "")) + parseInt($(a).height()) + 10; var c = parseInt($(a).css("left").replace("px", "")); var d = parent.window.document.getElementById("CanvasFrame"); if (b > d.clientHeight - 30) b = parseInt($(a).css("top").replace("px", "")) - 30; if (c > d.clientWidth - 148) { c = parseInt($(a).css("left").replace("px", "")) - 152; b = parseInt($(a).css("top").replace("px", "")) } $("form").find(".helper_box").css("top", b + "px"); $("form").find(".helper_box").css("left", c + "px") } function createAlignment(a) { $("form").append('<div class="top_align_box" style="z-index:100000;position:absolute;width:321px;height:540px;border-top:1px dotted gray;"/>'); var b = parseInt($(a).css("top").replace("px", "")) + 2; $("form").find(".top_align_box").css("top", $(a).css("top")); $("form").find(".top_align_box").css("left", "0px"); $("form").append('<div class="left_align_box" style="z-index:100000;position:absolute;width:321px;height:540px;border-left:1px dotted gray;"/>'); $("form").find(".left_align_box").css("top", "0px"); var c = parseInt($(a).css("left").replace("px", "")) + 2; $("form").find(".left_align_box").css("left", c + "px"); $("form").append('<div class="right_align_box" style="z-index:100000;position:absolute;width:321px;height:540px;border-left:1px dotted gray;"/>'); $("form").find(".right_align_box").css("top", "0px"); var d = parseInt($(a).css("left").replace("px", "")) + parseInt($(a).width()); $("form").find(".right_align_box").css("left", d + "px"); $("form").append('<div class="bottom_align_box" style="z-index:100000;position:absolute;width:321px;height:540px;border-top:1px dotted gray;"/>'); var e = parseInt($(a).css("top").replace("px", "")) + parseInt($(a).height()); $("form").find(".bottom_align_box").css("top", e + "px"); $("form").find(".bottom_align_box").css("left", "0px") } function removeAlignment() { $(".top_align_box").remove(); $(".left_align_box").remove(); $(".right_align_box").remove(); $(".bottom_align_box").remove() } function setSelectedHtml(a) { var b = document.getElementById("prev_selected_html"); b.value = a.wrap("<div>").parent().html() } function clearSelectedHtml() { var a = document.getElementById("prev_selected_html"); a.value = "" } function copySelectedElement() { if (prev_selected) { sessionStorage["prev_copied_html"] = outerHTML(prev_selected); var a = parent.window.document.getElementById("CopyClickImage"); a.border = "1" } else { alert("There is no selected field to copy"); var a = parent.window.document.getElementById("CopyClickImage"); a.border = "" } } function updateNextCopyNumber() { var a = parseInt(sessionStorage["next_copy_number"]) + 1; sessionStorage["next_copy_number"] = "" + a } function pasteSelectedElement() { var a = sessionStorage["prev_copied_html"]; if (a) { var b = a.indexOf('id="') + 4; var c = a.indexOf('"', b); var d = a.substring(b, c); if (d.length > 1 && d.substring(d.length - 1) == parseInt(sessionStorage["next_copy_number"]) - 1 + "") prev_copied_id = d.substring(0, d.length - 1) + sessionStorage["next_copy_number"]; else if (d.length > 2 && d.substring(d.length - 2) == parseInt(sessionStorage["next_copy_number"]) - 1 + "") prev_copied_id = d.substring(0, d.length - 2) + sessionStorage["next_copy_number"]; else prev_copied_id = d + sessionStorage["next_copy_number"]; a = a.replace('"' + d + '"', '"' + prev_copied_id + '"'); b = a.indexOf('title="MobiFlex Table"'); if (b > 0) { b = a.indexOf('fields="') + 8; c = a.indexOf('"', b); var e = a.substring(b, c); var f = e.split(":"); f = f[1].split(","); for (var g = 0; g < f.length; g++) { if (g == 0) { a = a.replace(":" + f[g], ":" + f[g] + sessionStorage["next_copy_number"]) } else { a = a.replace("," + f[g], "," + f[g] + sessionStorage["next_copy_number"]) } } } else { b = a.indexOf('title="MobiFlex Picker"'); if (b > 0) { b = a.indexOf('type="') + 6; c = a.indexOf('"', b); var h = a.substring(b, c); var f = h.split(":"); f = f[1].split(","); for (var g = 0; g < f.length; g++) { if (g == 0) { a = a.replace(":" + f[g], ":" + f[g] + sessionStorage["next_copy_number"]) } else { a = a.replace("," + f[g], "," + f[g] + sessionStorage["next_copy_number"]) } } } } updateNextCopyNumber(); b = a.indexOf("left:") + 5; c = a.indexOf("px", b); var i = a.substring(b, c); var j = parseInt(i) + 10; a = a.replace("left:" + i, "left:" + j); b = a.indexOf("top:") + 4; c = a.indexOf("px", b); var k = a.substring(b, c); var l = parseInt(k) + 10; a = a.replace("top:" + k, "top:" + l); b = a.indexOf("z-index:"); if (b > 0) { b += 8; c = a.indexOf(";", b); var m = a.substring(b, c); var n = parseInt(m) + 1; var o = "" + n; a = a.replace(m + ";", o + ";") } insertHtml(a, prev_copied_id); getCanvasHtml(); sessionStorage["prev_copied_html"] = a; if (prev_selected != null) { prev_selected.css("border-color", "transparent"); prev_selected = null; var p = parent.window.document.getElementById("CopyClickImage"); p.border = "" } clearSelectedHtml() } else alert("There is no field to paste") } function deleteSelectedElement() { if (prev_selected) { prev_selected.remove(); prev_selected = null; clearSelectedHtml() } } function getSelectedElement() { return prev_selected } function checkFocus() { alert(parent.window.document.activeElement + " has focus") } function checkRefreshStoryBoard() { if (parent.window.isMyPopUpWindowOpen()) { var a = parent.window.document.getElementById("ShouldRefreshStoryBoard"); if (a.value = "true") { a.value = ""; parent.window.refreshMyPopUpWindow() } else if (a.value = "close") { a.value = ""; parent.window.closeMyPopUpWindow() } } } function outerHTML(a) { if (a.outerHTML) return a.outerHTML; else return (new XMLSerializer).serializeToString(a[0]) } function noScrollIE() { parent.window.document.body.scroll = "no"; parent.window.document.body.style.overflow = "hidden" } function scrollIE() { parent.window.document.body.scroll = "yes"; parent.window.document.body.style.overflow = "scroll" } function noScrollNS() { if (!isFireFoxBrowser()) { parent.window.document.documentElement.style.overflowX = "hidden"; parent.window.document.documentElement.style.overflowY = "hidden" } } function scrollNS() { if (!isFireFoxBrowser()) { parent.window.document.documentElement.style.overflowX = "scroll"; parent.window.document.documentElement.style.overflowY = "scroll" } } function stopScrolling(a) { a.focus(); if (isOperaBrowser()) return; if (isIEBrowser()) noScrollIE(); else noScrollNS() } function resumeScrolling() { if (isOperaBrowser()) return; if (isIEBrowser()) scrollIE(); else scrollNS() } function SetSnapToGrid() { isGridSnapSet = true } function ResetSnapToGrid() { isGridSnapSet = false } function setGridSize(a) { gridSize = a } function getGridSize() { return gridSize } (function (a) { a.fn.vAlign = function () { return this.each(function (b) { var c = a(this).height(); var d = a(this).parent().height(); var e = -d / 2 - 4 * c / 3; a(this).css("top", e) }) } })(jQuery); var prev_selected; var is_control_down = false; $(function () { createDragResize('[title^="MobiFlex"]'); sessionStorage["next_copy_number"] = "1"; $(document).keydown(function (a) { var b = a.keyCode; if (b == "46" || b == "8") { $(".helper_box").remove(); deleteSelectedElement(); a.stopPropagation(); a.preventDefault(); getCanvasHtml() } else if (b == "37") { var c = parseInt(prev_selected.css("left").replace("px", "")) - 1; prev_selected.css("left", c + "px"); createHelper(prev_selected); a.stopPropagation(); a.preventDefault(); getCanvasHtml() } else if (b == "38") { var d = parseInt(prev_selected.css("top").replace("px", "")) - 1; prev_selected.css("top", d + "px"); createHelper(prev_selected); a.stopPropagation(); a.preventDefault(); getCanvasHtml() } else if (b == "39") { var c = parseInt(prev_selected.css("left").replace("px", "")) + 1; prev_selected.css("left", c + "px"); createHelper(prev_selected); a.stopPropagation(); a.preventDefault(); getCanvasHtml() } else if (b == "40") { var d = parseInt(prev_selected.css("top").replace("px", "")) + 1; prev_selected.css("top", d + "px"); createHelper(prev_selected); a.stopPropagation(); a.preventDefault(); getCanvasHtml() } else if (b == "17" || b == "224" || b == "91" || b == "93") { is_control_down = true } else if (b == "67" && is_control_down) { copySelectedElement() } else if (b == "86" && is_control_down) { pasteSelectedElement() } }); $(document).keyup(function (a) { var b = a.keyCode; if (b == "17" || b == "224" || b == "91" || b == "93") { is_control_down = false } }) }); var box; var frame_height; var isGridSnapSet = false; var gridSize = 10